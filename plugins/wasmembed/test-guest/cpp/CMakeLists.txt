include(ExternalProject)

set(WASI_SDK_PREFIX ${VCPKG_INSTALLED_DIR}/${VCPKG_TARGET_TRIPLET}/wasi-sdk)
set(WIT_BINDGEN_PREFIX ${VCPKG_INSTALLED_DIR}/${VCPKG_TARGET_TRIPLET}/share/wit-bindgen)

ExternalProject_Add(wasi-sdk
    SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/wasi-sdk
    BINARY_DIR ${CMAKE_CURRENT_BINARY_DIR}/wasi-sdk
    BUILD_ALWAYS TRUE
    PREFIX ${CMAKE_CURRENT_BINARY_DIR}/wasi-sdk
    CMAKE_ARGS 
        -DWIT_OUTPUT_DIR=${CMAKE_CURRENT_BINARY_DIR}
        -DWASI_SDK_PREFIX=${WASI_SDK_PREFIX}
        -DWIT_BINDGEN_PREFIX=${WIT_BINDGEN_PREFIX}
        -DCMAKE_TOOLCHAIN_FILE=${WASI_SDK_PREFIX}/share/cmake/wasi-sdk.cmake
        -DCMAKE_SYSROOT=${WASI_SDK_PREFIX}/share/wasi-sysroot
        -DCMAKE_INSTALL_PREFIX=${CMAKE_CURRENT_BINARY_DIR}
)
