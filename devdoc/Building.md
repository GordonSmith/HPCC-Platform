# Building 

## General 

The build process is generated by cmake.  It has a number of third-party dependencies and where possible it will use the versions provided by [vcpkg](https://github.com/microsoft/vcpkg), this ultimately helps simplify the build process and management of pre-requisites across disparate platforms.

Currently supported platforms are:
* Ubuntu 20.04
* Ubuntu 22.04
* CentOS 7
* CentOS 8
* Amazon Linux
* OSX 12

In addition the CLIENTTOOLS_ONLY builds are supported on:
* Windows 10
* Windows 11

Further there are two different build configurations:
* Bare Metal
* Docker / k8s / cloud

## Bare Metal Builds

### Prerequisites

Depending on the platform in question, the required pre-requisites will vary.  Rather than list the minimal requirements here, it is recommended to reference the following docker files:
* [Ubuntu 20.04](vcpkg/dockerfiles/ubuntu-20.04.dockerfile)
* [Ubuntu 22.04](vcpkg/dockerfiles/ubuntu-22.04.dockerfile)
* [CentOS 7](vcpkg/dockerfiles/centos-7.dockerfile)
* [CentOS 8](vcpkg/dockerfiles/centos-8.dockerfile)
* [Amazon Linux](vcpkg/dockerfiles/amazonlinux.dockerfile)

For OSX pre-requisites the following GitHub action is the best reference:
* [OSX](.github/workflows/build-assets.yml) - search for "OSX Dependencies"

::: code-group

<<< @/vcpkg/dockerfiles/ubuntu-20.04.dockerfile{6-27 docker}

<<< @/vcpkg/dockerfiles/ubuntu-22.04.dockerfile{6-27 docker}

<<< @/vcpkg/dockerfiles/centos-7.dockerfile{6-27 docker}

<<< @/vcpkg/dockerfiles/centos-8.dockerfile{6-27 docker}

<<< @/vcpkg/dockerfiles/amazonlinux.dockerfile{6-27 docker}

<<< @/.github/workflows/build-assets.yml{6-27 docker}

:::

### Clone the HPCC-Platform repository

```sh
git clone git@github.com:hpcc-systems/HPCC-Platform.git
cd HPCC-Platform
git submodule update --init --recursive
```

### Configuring CMake

1. Create a build directory, typically this is either a subfolder or a sibling of the source directory
2. Within the build directory, run cmake to configure the build

```sh
cd <HPCC-Platform source directory>
mkdir build
cd build
cmake -S .. -B . -DCMAKE_BUILD_TYPE=Debug -DINCLUDE_PLUGINS=ON -DSUPPRESS_V8EMBED=ON -DSUPPRESS_REMBED=ON 
```

::: warning
The fist time you configure the build, it will download and build the third-party dependencies.  This can take a while, so be patient.
:::

### Building

Within the same build folder as above, run the following command to build the HPCC-Platform

```sh
cmake --build . --parallel
```

### Packaging

Within the same build folder as above, run the following command to package the HPCC-Platform

```sh
cmake --build . --target package --parallel
```

### Changing branches

When changing branches within the HPCC-Platform repository, it is important to ensure that the submodules are updated to the correct branch.  Further when switching between MAJOR and MINOR point releases, it is advised to remove some local cache files prior to re-running the [cmake configuration](#configuring-cmake) step above:

```sh
cd build
rm -rf CMakeCache.txt CMakeFiles
rm ../vcpkg/vcpkg
```

::: tip
On windows the following would be required:
```sh
cd build
rm -rf CMakeCache.txt CMakeFiles
rm ../vcpkg/vcpkg.exe
```
:::

### Troubleshooting

In the event that configuration and/or building is failing, it is recomended to execute the following to "reset" your submodule and cmake caches:

```sh
cd <HPCC-Platform source directory>
git submodule update --init --recursive
cd build
rm -rf CMakeCache.txt CMakeFiles
rm ../vcpkg/vcpkg
```
